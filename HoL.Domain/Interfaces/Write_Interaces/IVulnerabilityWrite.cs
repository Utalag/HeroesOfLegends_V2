using HoL.Domain.Enums;

namespace HoL.Domain.Interfaces.Write_Interaces
{
    /// <summary>
    /// Rozhraní pro zápis profilu zranitelností bytosti.
    /// Umožňuje nastavit zranitelnosti, odolnosti a imunity vůči různým typům útoků.
    /// </summary>
    /// <remarks>
    /// <para>
    /// Toto rozhraní definuje zapisovatelné vlastnosti pro správu zranitelností bytosti.
    /// Implementující třída by měla zajistit konzistentní chování mezi těmito třemi kolekcemi.
    /// </para>
    /// <para><strong>Modifikátory poškození:</strong></para>
    /// <list type="bullet">
    ///   <item><term>Imunita (Immunities)</term><description>0.0x - bytost nebere žádné poškození</description></item>
    ///   <item><term>Odolnost (Resistances)</term><description>0.1x až 0.9x - bytost bere snížené poškození</description></item>
    ///   <item><term>Normální</term><description>1.0x - bytost bere plné poškození (výchozí)</description></item>
    ///   <item><term>Zranitelnost (Vulnerabilities)</term><description>1.1x až 3.0x+ - bytost bere zvýšené poškození</description></item>
    /// </list>
    /// <para><strong>Priorita vyhodnocení:</strong></para>
    /// <para>
    /// Při výpočtu finálního poškození se kontroluje v tomto pořadí:
    /// 1. Immunities (pokud je typ v této kolekci, modifikátor = 0.0)
    /// 2. Vulnerabilities (pokud je typ v této kolekci, použije se jeho hodnota)
    /// 3. Resistances (pokud je typ v této kolekci, použije se jeho hodnota)
    /// 4. Výchozí (pokud není nikde, modifikátor = 1.0)
    /// </para>
    /// </remarks>
    /// <example>
    /// <code>
    /// // Vytvoření profilu pro vampíra
    /// var vampire = new VulnerabilityProfil
    /// {
    ///     Vulnerabilities = new Dictionary&lt;VulnerabilityType, double&gt;
    ///     {
    ///         { VulnerabilityType.HolyWater, 2.0 },      // 200% poškození od svěcené vody
    ///         { VulnerabilityType.SpecificWeapon, 2.0 }  // 200% od dřevěného kůlu/stříbra
    ///     },
    ///     Resistances = new Dictionary&lt;VulnerabilityType, double&gt;
    ///     {
    ///         { VulnerabilityType.BluntForce, 0.5 },     // 50% poškození od tupých zbraní
    ///         { VulnerabilityType.SharpForce, 0.75 }     // 75% od ostrých zbraní
    ///     },
    ///     Immunities = new HashSet&lt;VulnerabilityType&gt;
    ///     {
    ///         VulnerabilityType.MentalSpells,            // Imunní vůči mentálním kouzlům
    ///         VulnerabilityType.AcidOrPotion             // Imunní vůči jedům
    ///     }
    /// };
    /// 
    /// // Výpočet poškození
    /// double damage = 50;
    /// double finalDamage = damage * vampire.GetDamageMultiplier(VulnerabilityType.HolyWater);
    /// // finalDamage = 100 (50 * 2.0)
    /// </code>
    /// </example>
    /// <seealso cref="IVulnerabilityRead"/>
    /// <seealso cref="VulnerabilityType"/>
    public interface IVulnerabilityWrite
    {
        /// <summary>
        /// Získává nebo nastavuje kolekci zranitelností a jejich úrovně závažnosti.
        /// </summary>
        /// <value>
        /// Dictionary obsahující páry <see cref="VulnerabilityType"/> a číselnou hodnotu modifikátoru (typicky 1.1 - 3.0).
        /// Hodnota modifikátoru určuje, kolikrát více poškození bytost obdrží od daného typu útoku.
        /// </value>
        /// <remarks>
        /// <para><strong>Doporučené hodnoty modifikátorů:</strong></para>
        /// <list type="table">
        ///   <listheader>
        ///     <term>Modifikátor</term>
        ///     <description>Typ zranitelnosti</description>
        ///   </listheader>
        ///   <item>
        ///     <term>1.25x</term>
        ///     <description>Mírná zranitelnost - bytost je lehce citlivější na tento typ útoku</description>
        ///   </item>
        ///   <item>
        ///     <term>1.5x - 2.0x</term>
        ///     <description>Standardní zranitelnost - běžná slabina bytosti</description>
        ///   </item>
        ///   <item>
        ///     <term>2.5x - 3.0x</term>
        ///     <description>Extrémní zranitelnost - kritická slabina (např. vampír vůči svěcené vodě)</description>
        ///   </item>
        /// </list>
        /// <para><strong>Pravidla a omezení:</strong></para>
        /// <list type="bullet">
        ///   <item>Hodnoty modifikátorů by měly být větší než 1.0 (hodnoty ≤ 1.0 patří do Resistances)</item>
        ///   <item>Dictionary nesmí obsahovat duplicitní klíče</item>
        ///   <item>Všechny klíče musí být platné hodnoty <see cref="VulnerabilityType"/></item>
        ///   <item>Ujistěte se, že stejný typ není současně v Immunities (imunita má přednost)</item>
        /// </list>
        /// <para><strong>Výpočet poškození:</strong></para>
        /// <code>
        /// finální_poškození = základní_poškození × modifikátor_zranitelnosti
        /// </code>
        /// </remarks>
        /// <example>
        /// <code>
        /// // Příklad: Démón zranitelný vůči svatým útokům
        /// var demon = new VulnerabilityProfil
        /// {
        ///     Vulnerabilities = new Dictionary&lt;VulnerabilityType, double&gt;
        ///     {
        ///         { VulnerabilityType.HolyWater, 3.0 },      // 300% - extrémně zranitelný
        ///         { VulnerabilityType.SpecificWeapon, 2.0 }, // 200% - svěcené zbraně
        ///         { VulnerabilityType.BlessedArrow, 2.5 }    // 250% - speciální útok
        ///     }
        /// };
        /// 
        /// // Útok svěcenou vodou
        /// int baseDamage = 30;
        /// double multiplier = demon.Vulnerabilities[VulnerabilityType.HolyWater]; // 3.0
        /// int finalDamage = (int)(baseDamage * multiplier); // 90
        /// </code>
        /// </example>
        /// <exception cref="ArgumentException">
        /// Vyhozena při pokusu přidat neplatný <see cref="VulnerabilityType"/> nebo záporný modifikátor.
        /// </exception>
        Dictionary<VulnerabilityType, double> Vulnerabilities { get; set; }

        /// <summary>
        /// Získává nebo nastavuje hodnoty odolnosti pro různé typy zranitelností.
        /// </summary>
        /// <value>
        /// Dictionary obsahující páry <see cref="VulnerabilityType"/> a číselnou hodnotu modifikátoru (typicky 0.1 - 0.9).
        /// Hodnota modifikátoru určuje, jaké procento původního poškození bytost obdrží.
        /// </value>
        /// <remarks>
        /// <para><strong>Doporučené hodnoty modifikátorů:</strong></para>
        /// <list type="table">
        ///   <listheader>
        ///     <term>Modifikátor</term>
        ///     <description>Typ odolnosti</description>
        ///   </listheader>
        ///   <item>
        ///     <term>0.75x - 0.9x</term>
        ///     <description>Mírná odolnost - bytost je lehce odolnější</description>
        ///   </item>
        ///   <item>
        ///     <term>0.5x - 0.7x</term>
        ///     <description>Standardní odolnost - poloviční až 70% poškození</description>
        ///   </item>
        ///   <item>
        ///     <term>0.25x - 0.4x</term>
        ///     <description>Silná odolnost - bytost je velmi odolná (např. golem vůči fyzickým útokům)</description>
        ///   </item>
        ///   <item>
        ///     <term>0.1x</term>
        ///     <description>Téměř imunita - pouze 10% poškození (zvažte použití Immunities)</description>
        ///   </item>
        /// </list>
        /// <para><strong>Pravidla a omezení:</strong></para>
        /// <list type="bullet">
        ///   <item>Hodnoty modifikátorů musí být v rozmezí 0.0 (exclusive) až 1.0 (exclusive)</item>
        ///   <item>Pro 0% poškození použijte Immunities místo Resistances s hodnotou 0.0</item>
        ///   <item>Dictionary nesmí obsahovat duplicitní klíče</item>
        ///   <item>Každý klíč musí odpovídat platnému <see cref="VulnerabilityType"/></item>
        ///   <item>Přímá modifikace této vlastnosti ovlivňuje výpočty odolnosti dané entity</item>
        /// </list>
        /// <para><strong>Výpočet poškození:</strong></para>
        /// <code>
        /// finální_poškození = základní_poškození × modifikátor_odolnosti
        /// </code>
        /// </remarks>
        /// <example>
        /// <code>
        /// // Příklad: Drak odolný vůči fyzickým útokům a částečně odolný vůči kouzlům
        /// var dragon = new VulnerabilityProfil
        /// {
        ///     Resistances = new Dictionary&lt;VulnerabilityType, double&gt;
        ///     {
        ///         { VulnerabilityType.BluntForce, 0.5 },     // 50% poškození od tupých zbraní
        ///         { VulnerabilityType.SharpForce, 0.6 },     // 60% od ostrých zbraní
        ///         { VulnerabilityType.ElementalSpells, 0.7 },// 70% od elementálních kouzel
        ///         { VulnerabilityType.PhysicalSpells, 0.7 }  // 70% od fyzických kouzel
        ///     }
        /// };
        /// 
        /// // Útok mečem
        /// int swordDamage = 80;
        /// double multiplier = dragon.Resistances[VulnerabilityType.SharpForce]; // 0.6
        /// int finalDamage = (int)(swordDamage * multiplier); // 48
        /// 
        /// // Dynamická změna odolnosti (např. buff kouzlem)
        /// dragon.Resistances[VulnerabilityType.ElementalForce] = 0.3; // Zvýšená odolnost vůči ohni
        /// </code>
        /// </example>
        /// <exception cref="ArgumentOutOfRangeException">
        /// Vyhozena při pokusu nastavit modifikátor mimo povolený rozsah (0.0, 1.0).
        /// </exception>
        Dictionary<VulnerabilityType, double> Resistances { get; set; }
        
        /// <summary>
        /// Získává nebo nastavuje kolekci typů zranitelností, vůči kterým je entita zcela imunní.
        /// </summary>
        /// <value>
        /// HashSet obsahující <see cref="VulnerabilityType"/> hodnoty, proti kterým je bytost imunní.
        /// Imunita znamená 0% poškození bez ohledu na sílu útoku.
        /// </value>
        /// <remarks>
        /// <para><strong>Použití imunit:</strong></para>
        /// <list type="bullet">
        ///   <item>
        ///     <term>Elementální bytosti</term>
        ///     <description>Ohnivý elemental je imunní vůči ohni, vodní elemental vůči vodním útokům</description>
        ///   </item>
        ///   <item>
        ///     <term>Nemrtví</term>
        ///     <description>Kostlivci jsou imunní vůči jedům, duchové vůči fyzickým útokům</description>
        ///   </item>
        ///   <item>
        ///     <term>Konstrukty</term>
        ///     <description>Golemi jsou imunní vůči mentálním útokům a manipulaci myslí</description>
        ///   </item>
        ///   <item>
        ///     <term>Magické bytosti</term>
        ///     <description>Démoni mohou být imunní vůči běžným zbraním (vyžadují magické/svěcené)</description>
        ///   </item>
        /// </list>
        /// <para><strong>Pravidla a priorita:</strong></para>
        /// <list type="number">
        ///   <item>Imunity má NEJVYŠŠÍ prioritu - pokud je typ zde, modifikátor je vždy 0.0</item>
        ///   <item>Imunita přebíjí jakékoliv hodnoty v Vulnerabilities nebo Resistances</item>
        ///   <item>HashSet automaticky ignoruje duplicitní hodnoty</item>
        ///   <item>Přímá modifikace této kolekce okamžitě ovlivňuje chování imunity entity</item>
        /// </list>
        /// <para><strong>Výkon:</strong></para>
        /// <para>
        /// HashSet poskytuje O(1) průměrnou složitost pro operace Contains, Add a Remove,
        /// což je optimální pro rychlé kontroly během výpočtu poškození v boji.
        /// </para>
        /// </remarks>
        /// <example>
        /// <code>
        /// // Příklad: Vampír s typickými imunitami
        /// var vampire = new VulnerabilityProfil
        /// {
        ///     Immunities = new HashSet&lt;VulnerabilityType&gt;
        ///     {
        ///         VulnerabilityType.MentalSpells,    // Nelze hypnotizovat
        ///         VulnerabilityType.AcidOrPotion,    // Imunní vůči jedům
        ///         VulnerabilityType.Domination       // Nelze ovládnout
        ///     }
        /// };
        /// 
        /// // Test imunity
        /// if (vampire.Immunities.Contains(VulnerabilityType.AcidOrPotion))
        /// {
        ///     Console.WriteLine("Jed nemá žádný účinek!");
        ///     // Výsledné poškození = 0
        /// }
        /// 
        /// // Dynamické přidání imunity (např. ochranné kouzlo)
        /// vampire.Immunities.Add(VulnerabilityType.ElementalForce);
        /// 
        /// // Odebrání imunity (např. prokletí)
        /// vampire.Immunities.Remove(VulnerabilityType.MentalSpells);
        /// </code>
        /// 
        /// <code>
        /// // Příklad: Ohnivý elemental
        /// var fireElemental = new VulnerabilityProfil
        /// {
        ///     Vulnerabilities = new Dictionary&lt;VulnerabilityType, double&gt;
        ///     {
        ///         { VulnerabilityType.ElementalSpells, 2.5 } // Zranitelný vůči vodě
        ///     },
        ///     Immunities = new HashSet&lt;VulnerabilityType&gt;
        ///     {
        ///         VulnerabilityType.ElementalForce,   // Imunní vůči ohni (i přes oheň v ElementalSpells)
        ///         VulnerabilityType.AcidOrPotion      // Nemá fyzickou formu pro jedy
        ///     }
        /// };
        /// 
        /// // Útok ohněm - imunita má přednost
        /// int fireDamage = 100;
        /// double multiplier = fireElemental.GetDamageMultiplier(VulnerabilityType.ElementalForce);
        /// // multiplier = 0.0 (imunita), i když ElementalSpells má 2.5x
        /// </code>
        /// </example>
        /// <exception cref="ArgumentNullException">
        /// Vyhozena při pokusu nastavit null hodnotu.
        /// </exception>
        HashSet<VulnerabilityType> Immunities { get; set; }
    }
}
